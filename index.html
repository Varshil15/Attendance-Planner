<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Planner - Smart Attendance Forecasting</title>
    <meta name="description" content="Smart attendance forecasting system to plan and track your academic attendance.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Outfit:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Login Screen Overlay -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-glow"></div>
            <div class="login-badge">ğŸ“š</div>
            <h1 class="login-title">Attendance Planner</h1>
            <p class="login-subtitle">Smart Attendance Forecasting System</p>
            <div class="login-divider"></div>
            <p class="login-prompt">Sign in to sync your data across devices</p>
            <button class="google-signin-btn" id="googleSignInBtn" onclick="signInWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 48 48">
                    <path fill="#EA4335"
                        d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z" />
                    <path fill="#4285F4"
                        d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z" />
                    <path fill="#FBBC05"
                        d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z" />
                    <path fill="#34A853"
                        d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z" />
                </svg>
                <span>Sign in with Google</span>
            </button>
            <p class="login-footer">Your data is securely stored and synced</p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Loading your data...</p>
    </div>

    <div class="container" id="appContainer" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="header-top-bar">
                <div class="user-profile" id="userProfile">
                    <img class="user-avatar" id="userAvatar" src="" alt="avatar">
                    <span class="user-name" id="userName"></span>
                </div>
                <button class="logout-btn" onclick="handleLogout()" title="Sign Out">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                    Sign Out
                </button>
            </div>
            <div class="header-badge">ğŸ“š</div>
            <h1>Attendance Planner</h1>
            <p>Smart Attendance Forecasting System</p>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value" id="currentPercentage">0%</div>
                <div class="stat-label">Current Attendance</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“‹</div>
                <div class="stat-value" id="totalConducted">0</div>
                <div class="stat-label">Total Conducted</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">âœ…</div>
                <div class="stat-value" id="totalAttended">0</div>
                <div class="stat-label">Total Attended</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“–</div>
                <div class="stat-value" id="totalSubjects">0</div>
                <div class="stat-label">Total Subjects</div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" data-tab="dashboard">
                <span class="tab-icon">ğŸ“Š</span>
                <span class="tab-text">Dashboard</span>
            </button>
            <button class="tab" data-tab="timetable">
                <span class="tab-icon">ğŸ“…</span>
                <span class="tab-text">Timetable</span>
            </button>
            <button class="tab" data-tab="attendance">
                <span class="tab-icon">âœ…</span>
                <span class="tab-text">Mark Attendance</span>
            </button>
            <button class="tab" data-tab="future">
                <span class="tab-icon">ğŸ”®</span>
                <span class="tab-text">Future Planner</span>
            </button>
        </div>

        <!-- Tab Contents -->

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="section-header">
                <h2>ğŸ“Š Dashboard Overview</h2>
            </div>

            <div id="dashboardAlert"></div>

            <div class="card">
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Overall Attendance Progress</span>
                        <span id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%;">
                            <span id="progressText">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-20">
                <h3>âš¡ Quick Actions</h3>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openExtraLectureModal()">
                        â• Add Extra Lecture
                    </button>
                    <button class="btn btn-info" onclick="openInitialAttendanceModal()">
                        ğŸ“ Add Conducted Lectures
                    </button>
                    <button class="btn btn-success" onclick="switchTab('attendance')">
                        âœ… Mark Today's Attendance
                    </button>
                    <button class="btn btn-secondary" onclick="switchTab('future')">
                        ğŸ”® Plan Future
                    </button>
                </div>
            </div>

            <div class="mt-20">
                <div class="section-header">
                    <h3>ğŸ“– Subject-wise Attendance</h3>
                </div>
                <div class="subjects-grid" id="dashboardSubjectsGrid"></div>
            </div>
        </div>

        <!-- Timetable Tab -->
        <div class="tab-content" id="timetable">
            <div class="section-header mb-20">
                <h2>ğŸ“… Weekly Timetable</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openBulkAddModal()">
                        â• Add Lectures
                    </button>
                    <button class="btn btn-secondary" onclick="exportTimetable()">
                        â¬‡ï¸ Export
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importTimetableInput').click()">
                        â¬†ï¸ Import
                    </button>
                    <input type="file" id="importTimetableInput" accept="application/json" style="display:none"
                        onchange="importTimetable(event)">
                </div>
            </div>

            <div class="timetable-grid" id="timetableGrid"></div>
        </div>

        <!-- Mark Attendance Tab -->
        <div class="tab-content" id="attendance">
            <div class="section-header">
                <h2>âœ… Mark Attendance</h2>
            </div>

            <div class="card">
                <div class="form-group">
                    <label for="attendanceDate">Select Date:</label>
                    <input type="date" id="attendanceDate" class="form-control">
                </div>
            </div>

            <div id="attendanceLectures"></div>
        </div>

        <!-- Future Planner Tab -->
        <div class="tab-content" id="future">
            <div class="section-header">
                <h2>ğŸ”® Future Attendance Planner</h2>
            </div>

            <div class="alert alert-info">
                <span>ğŸ’¡</span>
                <span>Click on lectures to simulate: 1st click = Attended (green), 2nd click = Absent (red), 3rd click =
                    Not Conducted (gray), 4th click = Reset</span>
            </div>

            <div id="futureProjection"></div>

            <div class="timetable-grid" id="futureTimetableGrid"></div>
        </div>

    </div>



    <!-- Bulk Add Lectures Modal -->
    <div class="modal" id="bulkAddModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <span class="modal-icon">â•</span>
                <span>Add Lectures</span>
            </div>

            <div class="form-group">
                <label for="bulkDay">Select Day:</label>
                <select id="bulkDay" class="form-control">
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                </select>
            </div>

            <div class="alert alert-info">
                <span>â„¹ï¸</span>
                <span>Add all lectures for the selected day. Click "Add Lecture" to add more rows.</span>
            </div>


            <div id="bulkLecturesContainer">
                <div class="bulk-lecture-row">
                    <input type="text" class="form-control" placeholder="Subject Name" style="flex: 2;">
                    <select class="form-control" style="flex: 1;">
                        <option value="Lecture" selected>Lecture</option>
                        <option value="Lab">Lab</option>
                    </select>
                    <button class="btn-icon btn-delete" onclick="removeBulkRow(this)">ğŸ—‘ï¸</button>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="addBulkLectureRow()" style="margin: 15px 0;">
                â• Add Another Lecture
            </button>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBulkAddModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveBulkLectures()">Save All Lectures</button>
            </div>
        </div>
    </div>

    <!-- Extra Lecture Modal -->
    <div class="modal" id="extraLectureModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-icon">â•</span>
                <span>Add Extra Lecture</span>
            </div>

            <div class="alert alert-info">
                <span>â„¹ï¸</span>
                <span>This lecture is for today only and won't appear in your regular timetable.</span>
            </div>

            <div class="form-group">
                <label for="extraLectureDate">Date:</label>
                <input type="date" id="extraLectureDate" class="form-control">
            </div>

            <div class="form-group">
                <label for="extraLectureSubject">Subject Name:</label>
                <input type="text" id="extraLectureSubject" class="form-control" placeholder="e.g., Mathematics">
            </div>

            <div class="form-group">
                <label for="extraLectureType">Type:</label>
                <select id="extraLectureType" class="form-control">
                    <option value="Lecture" selected>Lecture</option>
                    <option value="Lab">Lab</option>
                </select>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeExtraLectureModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveExtraLecture()">Add Extra Lecture</button>
            </div>
        </div>
    </div>

    <!-- Initial Attendance Modal -->
    <div class="modal" id="initialAttendanceModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <span class="modal-icon">ğŸ“</span>
                <span>Add Conducted Lectures</span>
            </div>

            <div class="alert alert-info">
                <span>â„¹ï¸</span>
                <span>Select subjects from your timetable and add previously conducted lectures. This helps track your
                    attendance from the beginning of the semester.</span>
            </div>

            <div id="initialAttendanceContainer">
                <div class="initial-attendance-row">
                    <select class="form-control" style="flex: 2;">
                        <option value="">Select Subject</option>
                    </select>
                    <input type="number" class="form-control" placeholder="Conducted" min="0" style="flex: 1;">
                    <input type="number" class="form-control" placeholder="Attended" min="0" style="flex: 1;">
                    <button class="btn-icon btn-delete" onclick="removeInitialAttendanceRow(this)">ğŸ—‘ï¸</button>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="addInitialAttendanceRow()" style="margin: 15px 0;">
                â• Add Another Subject
            </button>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInitialAttendanceModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveInitialAttendance()">Save All Data</button>
            </div>
        </div>
    </div>

    <script src="supabase-config.js"></script>
    <script src="script.js"></script>
</body>

</html>